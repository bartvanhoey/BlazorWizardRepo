@using System.ComponentModel.DataAnnotations
<EditForm EditContext="_editContext" >
    <DataAnnotationsValidator/>

    <div class="mb-3">
        <label class="form-label" for="username">Username (Email)</label>
        <InputText class="form-control" id="username" @bind-Value="_credentialsInputModel.Username"/>
    </div>

    <div class="mb-3">
        <label class="form-label" for="password">Password</label>
        <InputText class="form-control" type="password" id="password" @bind-Value="_credentialsInputModel.Password"/>
    </div>

    <div class="mb-3">
        <label class="form-label" for="confirmPassword">Confirm Password</label>
        <InputText class="form-control" type="password" id="confirmPassword" @bind-Value="_credentialsInputModel.ConfirmPassword"/>
    </div>

</EditForm>

@code {
    [Parameter] public EventCallback<CredentialsInfoResult> OnCredentialsEntered { get; set; }
    [Parameter] public bool IsCredentialsEntryValid { get; set; }
    private EditContext? _editContext;
    private CredentialsInputModel _credentialsInputModel = new();

    protected override void OnInitialized()
    {
        _editContext = new EditContext(_credentialsInputModel);
        _editContext.OnFieldChanged += EditContextOnOnFieldChanged;
    }
    
    private void EditContextOnOnFieldChanged(object? sender, FieldChangedEventArgs e)
    {
        var isValid = _editContext != null && _editContext.Validate();
        OnCredentialsEntered.InvokeAsync(new CredentialsInfoResult(_credentialsInputModel.Username, _credentialsInputModel.Password, isValid));
    }

    
    
    public class CredentialsInputModel
    {
        [Required] [EmailAddress] public string? Username { get; set; }

        [Required] [MinLength(6)] public string? Password { get; set; }

        [Required]
        [Compare(nameof(Password), ErrorMessage = "Passwords do not match.")]
        public string? ConfirmPassword { get; set; }
    }

}



